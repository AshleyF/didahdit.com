<html>
    <head>
        <title>CW Tools</title>
        <style>
            body {
                background-color: black;
                color: white;
                font-family: sans-serif; }
            a { color: #eee; }
            button { background-color: #555; color: #eee; }
            textarea { background-color: #555; color: #eee; }
            hr { color: #555; }
        </style>
        <script>
            const defaultSpeed = 25;
            const canvasWidth = 1450;
            const canvasHeight = 64;

            var connectedPort = null;
            var morse = "  ETIANMSURWDKGOHVF L PJBXCYZQ  54 3   2& +    16=/   ( 7   8 90     $      ?_    \"  .    @   '  -        ;! )     ,    :";
            var p = 1;
            var message = "&nbsp;";
            var sending = "";
            var char = '';

            var audioStarted = false;
            var audioCtx;
            var gain;

            function startAudio() {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                var oscillator = audioCtx.createOscillator();
                oscillator.frequency.value = 750;
                gain = audioCtx.createGain();
                gain.gain.value = 0;
                oscillator.connect(gain);
                gain.connect(audioCtx.destination);
                oscillator.start(0);
                audioStarted = true;
            }

            var rate;
            var ditlen;
            var delay = 0.03;
            var ramp = 0.01;

            function setRate(wpm) {
                rate = wpm;
                ditlen = 1.2 / rate;
            }

            var t = 0;
            function playTone(len) {
                if (!audioStarted) startAudio();
                var c = audioCtx.currentTime;
                t = c > t ? c : t;
                gain.gain.setTargetAtTime(1, t, ramp);
                t += len;
                gain.gain.setTargetAtTime(0, t, ramp);
                t += ditlen;
                var end = (new Date()).getTime() / 1000 + len;
                letterBreak = end + (ditlen * 3);
                wordBreak = end + (ditlen * 7);
            }

            function dit() {
                p *= 2;
                updateCharacter();
                playTone(ditlen)
            }

            function dah() {
                p = p * 2 + 1;
                updateCharacter();
                playTone(3 * ditlen);
            }

            function load() {
                if (!("serial" in navigator)) {
                    // The Web Serial API is supported.
                    alert("SERIAL UNAVAILABLE");
                }
                navigator.serial.addEventListener('connect', (e) => {
                    // Connect to `e.target` or add it to a list of available ports.
                    //alert("Connected: " + JSON.stringify(e));
                });
                navigator.serial.addEventListener('disconnect', (e) => {
                    // Remove `e.target` from the list of available ports.
                    //alert("Disconnected: " + JSON.stringify(e));
                });
                document.getElementById("message").addEventListener('keypress', (e) => {
                    if (e.charCode == 13 && connectedPort != null) {
                        sendMessage();
                        e.target.value = "";
                        e.preventDefault();
                    }
                });
                document.body.addEventListener('keydown', (e) => {
                    if (!e.repeat && e.srcElement.id != "message") {
                        switch (e.code) {
                            case "Comma":
                                setKeys(true, rightDown);
                                break;
                            case "Period":
                                setKeys(leftDown, true);
                                break;
                            case "Escape":
                                reset();
                                break;
                        }
                    }
                });
                document.body.addEventListener('keyup', (e) => {
                    if (e.srcElement.id != "message") {
                        switch (e.code) {
                            case "Comma":
                                setKeys(false, rightDown);
                                break;
                            case "Period":
                                setKeys(leftDown, false);
                                break;
                        }
                    }
                });
                reset();
                setRate(defaultSpeed);
                read();
                drawKeyAndToneState();
            }

            function connect() {
                // const port = await navigator.serial.requestPort();
                //const usbVendorId = 0xABCD;
                //navigator.serial.requestPort({ filters: [{ usbVendorId }]}).then((port) => {
                navigator.serial.requestPort().then((port) => {
                    // Connect to `port` or add it to the list of available ports.
                    port.open({ baudRate: 9600 }).then(() => {
                        connectedPort = port;
                        setSpeed(defaultSpeed);
                    }).catch(e => {
                        alert("ERROR OPENING: " + e);
                    });
                    //navigator.serial.getPorts().then((ports) => {
                    //    // Initialize the list of available ports with `ports` on page load.
                    //    alert("Ports: " + JSON.stringify(ports));
                    //});
                }).catch((e) => {
                    // The user didn't select a port.
                    alert("ERROR NO PORT CHOSEN: " + JSON.stringify(e));
                });
            }
            
            function disconnect() {
                if (connectedPort != null) {
                    connectedPort.close();
                    // TODO: reader busy/locked https://stackoverflow.com/questions/65748344/how-can-i-interrupt-a-reader-when-it-hangs-need-a-timeout-on-reader-read
                }
            }

            function setMode(mode) { // (Iambic)A (Imabic)B U(ltimatic)
                if (connectedPort != null) {
                    const writer = connectedPort.writable.getWriter();
                    writer.write(new Uint8Array([mode])).then(() => {
                        writer.releaseLock();
                    });
                }
            }

            function setSpeed(speed) {
                if (connectedPort != null) {
                    const writer = connectedPort.writable.getWriter();
                    writer.write(new Uint8Array([speed + 200])).then(() => {
                        writer.releaseLock();
                        setRate(speed);
                    });
                }
            }

            function setKeys(left, right) {
                leftDown = left;
                rightDown = right;
                if (connectedPort != null) {
                    const writer = connectedPort.writable.getWriter();
                    writer.write(new Uint8Array([(left ? 0x2 : 0) | (right ? 0x1 : 0)])).then(() => {
                        writer.releaseLock();
                    });
                }
            }

            function send(message) {
                if (connectedPort != null) {
                    sending += message.toUpperCase() + ' ';
                    updateDisplay();
                    var data = [];
                    var word = [];
                    var prosign = false;
                    for (var i in message) {
                        var m = message[i];
                        if (m == ' ') { // word break
                            data.push(47);
                        } else {
                            if (m == '<') prosign = true;
                            if (m == '>') prosign = false;
                            var j = morse.indexOf(m.toUpperCase());
                            while (j > 1) {
                                if (j % 2 == 0) {
                                    word.push(46); // dit
                                    j /= 2;
                                } else {
                                    word.push(45); // dah
                                    j = (j - 1) / 2;
                                }
                            }
                            data = data.concat(word.reverse());
                            word = [];
                            if (!prosign) data.push(32); // letter-break
                        }
                    }
                    data.push(47); // final word break
                    const writer = connectedPort.writable.getWriter();
                    writer.write(new Uint8Array(data)).then(() => {
                        writer.releaseLock();
                    });
                }
            }

            function sendMessage() {
                if (connectedPort != null) {
                    send(document.getElementById("message").value);
                }
            }

            function updateDisplay() {
                function escape(str) {
                    return str.replace('<', "&lt;").replace('>', "&gt;");
                }
                document.getElementById('copy').innerHTML = escape(message) + escape(char) + "<span style='color:#555'>" + escape(sending) + "</span>";
            }

            function reset() {
                message = "&nbsp;";
                sending = "";
                p = 1;
                char = '';
                updateDisplay();
                var canvas = document.getElementById("canvas");
                var ctx = canvas.getContext("2d");
                ctx.fillStyle = "#000";
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                cursor = 20;
            }

            var canvasVisible = true;
            function toggle() {
                document.getElementById('canvas').style.display = canvasVisible ? 'none' : '';
                canvasVisible = !canvasVisible;
            }

            function updateCharacter() {
                function setProsign(sign) {
                    char = '<' + sign + '>';
                }
                switch (p) {
                    case 31: // backspace
                        // TODO
                        break;
                    case 21:
                        setProsign("AA");
                        break;
                    case 34:
                        setProsign("VE");
                        break;
                    case 37:
                        setProsign("INT");
                        break;
                    case 42:
                        setProsign("AR");
                        break;
                    case 53:
                        setProsign("CT");
                        break;
                    case 69:
                        setProsign("SK");
                        break;
                    case 103:
                        setProsign("NJ");
                        break;
                    case 568:
                        setProsign("SOS");
                        break;
                    case 256: // correction (clear)
                        // TODO
                        message = "&nbsp;";
                        char = '';
                        break;
                    default:
                        if (p >= 121) { // unknown
                            // TODO
                            char = '';
                        } else {
                            char = morse[p];
                            if (char == ' ') { // unknown?
                                char = '';
                            }
                        }
                        break;
                }
                if (sending.startsWith(char)) {
                    sending = sending.substring(char.length);
                } else if (sending.startsWith(' ') && sending.length > 1 && sending.substring(1).startsWith(char)) {
                    sending = sending.substring(char.length + 1);
                }
                updateDisplay();
            }

            function copy(b) {
                switch (b) {
                    case 46: // dit
                        dit();
                        break;
                    case 45: // dah
                        dah();
                        break;
                }
            }

            var cursor = 20;
            var leftDown = false;
            var rightDown = false;
            var letterBreak = 0;
            var wordBreak = 0;
            var lastGain = 0;
            var clearNextKeyState = false;
            var clearNextMessage = false;

            function drawKeyAndToneState() {
                const ribbon = canvasHeight / 8;
                var now = (new Date()).getTime() / 1000;
                if (now < wordBreak) {
                    var canvas = document.getElementById("canvas");
                    var ctx = canvas.getContext("2d");
                    if (clearNextKeyState) {
                        ctx.fillStyle = "#000";
                        ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                        cursor = 20;
                        clearNextKeyState = false;
                    }
                    if (clearNextMessage) {
                        message = "&nbsp;";
                        updateDisplay();
                        clearNextMessage = false;
                    }
                    var currentGain = gain.gain.value;
                    if ((lastGain < 0.5 && currentGain > 0.5) || (lastGain > 0.5 && currentGain < 0.5)) {
                        ctx.fillStyle = "#555"; // mark tone boundaries
                        lastGain = currentGain;
                    } else {
                        ctx.fillStyle = "#000"; // erase cursor
                    }
                    ctx.fillRect(cursor, 0, 1, canvasHeight);
                    if (leftDown) {
                        ctx.fillStyle = "#00F";
                        ctx.fillRect(cursor, ribbon, 1, ribbon);
                    }
                    if (rightDown) {
                        ctx.fillStyle = "#F00";
                        ctx.fillRect(cursor, ribbon * 3, 1, ribbon);
                    }
                   if (currentGain > 0.5) {
                        ctx.fillStyle = "#fff";
                        ctx.fillRect(cursor, ribbon * 5, 1, ribbon * 2);
                    }
                    cursor = ++cursor % canvasWidth;
                    ctx.fillStyle = "#0F0";
                    ctx.fillRect(cursor, 0, 1, canvasHeight);
                }
                if (now - letterBreak > 0) {
                    message += char;
                    char = '';
                    p = 1;
                }
                if (now - wordBreak > 0 && !message.endsWith(' ')) {
                    message += ' ';
                }
                if (now - wordBreak > ditlen * 7.0) {
                    clearNextKeyState = true;
                }
                if (now - wordBreak > ditlen * 50) {
                    clearNextMessage = true;
                }

                window.setTimeout(drawKeyAndToneState, 1);
            }

            function read() {
                if (connectedPort != null) {
                    const reader = connectedPort.readable.getReader();
                    reader.read().then(x =>
                    {
                        for (var i in x.value) {
                            var v = x.value[i];
                            if (v < 4) {
                                leftDown = (v & 0x2) != 0;
                                rightDown = (v & 0x1) != 0;
                            } else {
                                copy(v);
                            }
                        }
                        reader.releaseLock();
                        window.setTimeout(read, 10);
                    });
                } else {
                    window.setTimeout(read, 10);
                }
            }

            function simulateKeys(keys) {
                var next = (new Date()).getTime();
                function updateKeyState() {
                    if (keys.length > 0) {
                        var k = keys[0];
                        keys = keys.substring(1);
                        setKeys(k == 'L' || k == 'S', k == 'R' || k == 'S');
                        next += ditlen * 1000 / 2;
                        window.setTimeout(updateKeyState, next - (new Date()).getTime());
                    } else {
                        setKeys(false, false);
                    }
                }
                updateKeyState();
            }

            function experiment() {
                simulateKeys(document.getElementById("message").value);
            }
        </script>
    </head>
    <body onload="load()">
        <h1 id="copy">&nbsp;</h1>
        <textarea id="message" rows="2" cols="120"></textarea>
        <hr />
        <canvas id="canvas" width="1450px" height="64px" style="border: 1px solid black"></canvas>
        <hr />
        <button id="connect" onclick="connect()">Connect</button>
        <button id="disconnect" onclick="disconnect()">Disconnect</button>
        <button id="send" onclick="sendMessage()">Send</button>
        <button id="reset" onclick="reset()">Clear</button>
        <button id="toggle" onclick="toggle()">Toggle</button>
        <button id="experiment" onclick="experiment()">Experiment</button>
        <hr />
        <button id="iambicA" onclick="setMode(65)">Iambic A</button>
        <button id="iambicB" onclick="setMode(66)">Iambic B</button>
        <button id="iambicU" onclick="setMode(85)">Ultimatic</button>
        <hr />
        <button id="speed5" onclick="setSpeed(5)">5 WPM</button>
        <button id="speed10" onclick="setSpeed(10)">10 WPM</button>
        <button id="speed15" onclick="setSpeed(15)">15 WPM</button>
        <button id="speed20" onclick="setSpeed(20)">20 WPM</button>
        <button id="speed21" onclick="setSpeed(21)">21 WPM</button>
        <button id="speed22" onclick="setSpeed(22)">22 WPM</button>
        <button id="speed23" onclick="setSpeed(23)">23 WPM</button>
        <button id="speed24" onclick="setSpeed(24)">24 WPM</button>
        <button id="speed25" onclick="setSpeed(25)">25 WPM</button>
        <button id="speed30" onclick="setSpeed(30)">30 WPM</button>
        <button id="speed40" onclick="setSpeed(40)">40 WPM</button>
        <button id="speed50" onclick="setSpeed(50)">50 WPM</button>
        <hr />
        <a href="javascript:send('CQ')">CQ</a>
        <a href="javascript:send('QRL?')">QRL?</a>
        <a href="javascript:send('CU')">CU</a>
        <a href="javascript:send('DE')">DE</a>
        <a href="javascript:send('K')">K</a>
        <a href="javascript:send('KN')">KN</a>
        <a href="javascript:send('OP')">OP</a>
        <a href="javascript:send('NAME')">NAME</a>
        <a href="javascript:send('UR')">UR</a>
        <a href="javascript:send('RST')">RST</a>
        <a href="javascript:send('IS')">IS</a>
        <a href="javascript:send('599')">599</a>
        <a href="javascript:send('5NN')">5NN</a>
        <a href="javascript:send('KK7HXU')">KK7HXU</a>
        <a href="javascript:send('ASHLEY')">ASHLEY</a>
        <hr />
        <ul>
            <li>
                <b>Repetitive:</b>
                <ul>
                    <li><!--                              --  -->
                        <a href="javascript:simulateKeys('L')"><I>E</I></a>
                        <a href="javascript:simulateKeys('LL')">E</a>
                        <a href="javascript:simulateKeys('LLL')">E</a>
                        <span>&nbsp;</span><!--           --  --  -->
                        <a href="javascript:simulateKeys('LLLLL')">I</a>
                        <a href="javascript:simulateKeys('LLLLLL')"><i>I</i></a>
                        <a href="javascript:simulateKeys('LLLLLLL')">I</a>
                        <span>&nbsp;</span><!--           --  --  --  -->
                        <a href="javascript:simulateKeys('LLLLLLLLL')">S</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLL')"><i>S</i></a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLL')">S</a>
                        <span>&nbsp;</span><!--           --  --  --  --  -->
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLL')">H</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLL')"><i>H</i></a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLL')">H</a>
                        <span>&nbsp;</span><!--           --  --  --  --  --  -->
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLLLL')">5</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLLLLL')"><i>5</i></a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLLLLLL')">5</a>
                    </li>
                    <li><!--                              ------  -->
                        <a href="javascript:simulateKeys('R')"><I>T</I></a>
                        <a href="javascript:simulateKeys('RRRR')">T</a>
                        <a href="javascript:simulateKeys('RRRRRRR')">T</a>
                        <span>&nbsp;</span><!--           ------  ------  -->
                        <a href="javascript:simulateKeys('RRRRRRRRR')">M</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRR')"><i>M</i></a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRR')">M</a>
                        <span>&nbsp;</span><!--           ------  ------  ------  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRR')">O</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRR')"><i>O</i></a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRR')">O</a>
                        <span>&nbsp;</span><!--           ------  ------  ------  ------  ------  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR')">0</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR')"><i>0</i></a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR')">0</a>
                    </li>
                </ul>
            </li>
            <li>
                <b>Initial Switch:</b>
                <ul>
                    <li>
                        <span>Slap:</span><!--            --  ------  -->
                        <a href="javascript:simulateKeys('LLRR')">A</a>
                        <a href="javascript:simulateKeys('LLLRRR')"><i>A</i></a>
                        <a href="javascript:simulateKeys('LLL RRR')">A (small gap)</a>
                        <a href="javascript:simulateKeys('LLL     RRR')">A (big gap)</a>
                        <a href="javascript:simulateKeys('LLLRRRRRRRR')">A</a>
                        <span>&nbsp;</span><!--           --  ------  ------  -->
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRR')">W</a>
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRRRRR')"><I>W</I></a>
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRRRRRRRR')">W</a>
                        <span>&nbsp;</span><!--           --  ------  ------  ------  -->
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRRRRRRRRRR')">J</a>
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRRRRRRRRRRRRR')"><I>J</I></a>
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRRRRRRRRRRRRRRRR')">J</a>
                        <span>&nbsp;</span><!--           --  ------  ------  ------  ------  -->
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRRRRRRRRRRRRRRRRRR')">1</a>
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR')"><I>1</I></a>
                        <a href="javascript:simulateKeys('LLRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR')">1</a>
                        <span>Squeeze/Ultimatic:</span>
                        <!--                              --  ------  -->
                        <a href="javascript:simulateKeys('LSS')">A (quick)</a>
                        <a href="javascript:simulateKeys('LLLSSS')"><i>A</i></a>
                        <a href="javascript:simulateKeys('LLLSSSSSSSS')">A</a>
                        <span>&nbsp;</span><!--           --  ------  ------  -->
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSS')">W</a>
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSS')"><I>W</I></a>
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSS')">W</a>
                        <span>&nbsp;</span><!--           --  ------  ------  ------  -->
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSSSS')">J</a>
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSSSSSSS')"><I>J</I></a>
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSSSSSSSSSS')">J</a>
                        <span>&nbsp;</span><!--           --  ------  ------  ------  ------  -->
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSSSSSSSSSSSS')">6</a>
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS')"><I>6</I></a>
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS')">6</a>
                    </li>
                    <li>
                        <span>Slap:</span><!--            ------  --  -->
                        <a href="javascript:simulateKeys('RRLL')">N</a>
                        <a href="javascript:simulateKeys('RRRLLL')"><I>N</I></a>
                        <a href="javascript:simulateKeys('RRR     LLL')">N (small gap)</a>
                        <a href="javascript:simulateKeys('RRR          LLL')">N (big gap)</a>
                        <a href="javascript:simulateKeys('RRRLLLLLLLL')">N</a>
                        <span>&nbsp;</span><!--           ------  --  --  -->
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLL')">D</a>
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLLL')">D</a>
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLLLL')">D</a>
                        <span>&nbsp;</span><!--           ------  --  --  --  -->
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLLLLLL')">B</a>
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLLLLLLL')">B</a>
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLLLLLLLL')">B</a>
                        <span>&nbsp;</span><!--           ------  --  --  --  --  -->
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLLLLLLLLLL')">6</a>
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLLLLLLLLLLL')">6</a>
                        <a href="javascript:simulateKeys('RRLLLLLLLLLLLLLLLLLLLLL')">6</a>
                        <span>Squeeze/Ultimatic:</span>
                        <!--                              ------  --  -->
                        <a href="javascript:simulateKeys('RSS')"><I>N (quick)</I></a>
                        <a href="javascript:simulateKeys('RRRSSS')">N</a>
                        <a href="javascript:simulateKeys('RRRSSSSSSSS')">N</a>
                        <span>&nbsp;</span><!--           ------  --  --  -->
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSS')">D</a>
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSS')"><I>D</I></a>
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSS')">D</a>
                        <span>&nbsp;</span><!--           ------  --  --  --  -->
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSSSS')">B</a>
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSSSSS')"><I>B</I></a>
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSSSSSS')">B</a>
                        <span>&nbsp;</span><!--           ------  --  --  --  --  -->
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSSSSSSSS')">6</a>
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSSSSSSSSS')"><I>6</I></a>
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSSSSSSSSSS')">6</a>
                    </li>
                </ul>
            </li>
            <li>
                <b>Ending Switch:</b>
                <ul>
                    <li>
                        <span>Slap:</span><!--            --  --  ------  -->
                        <a href="javascript:simulateKeys('LLLLLRR')"><i>U</i></a>
                        <a href="javascript:simulateKeys('LLLLLLRR')"><i>U</i></a>
                        <a href="javascript:simulateKeys('LLLLLLLRR')">U</a>
                        <a href="javascript:simulateKeys('LLLLLL  RRRRRR')">U (on-beat)</a>
                        <a href="javascript:simulateKeys('LLLLLLL       RRRRR')">U (gap)</a>
                        <span>&nbsp;</span><!--           --  --  --  ------ -->
                        <a href="javascript:simulateKeys('LLLLLLLLLRR')">V</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLRR')"><I>V</I></a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLRR')">V</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLL  RRRRRR')">V (on-beat)</a>
                        <span>&nbsp;</span><!--           --  --  --  --  ------  -->
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLRR')">4</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLRR')"><I>4</I></a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLLRR')">4</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLL  RRRRRR')">4 (on-beat)</a>
                        <span>Squeeze/Ultimatic:</span>
                        <!--                              --  --  ------  -->
                        <a href="javascript:simulateKeys('LLLLLSS')">U</a>
                        <a href="javascript:simulateKeys('LLLLLLSS')"><i>U</i></a>
                        <a href="javascript:simulateKeys('LLLLLLLSS')">U</a>
                        <a href="javascript:simulateKeys('LLLLLLLSSSSSSS')">U (late/long)</a>
                        <span>&nbsp;</span><!--           --  --  --  ------  -->
                        <a href="javascript:simulateKeys('LLLLLLLLLSS')">V</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLSS')"><i>V</i></a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLSS')">V</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLSSSSSSS')">V (late/long)</a>
                        <span>&nbsp;</span><!--           --  --  --  --  ------  -->
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLSS')">4</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLSS')"><i>4</i></a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLLSS')">4</a>
                        <a href="javascript:simulateKeys('LLLLLLLLLLLLLLLSSSSSSS')">4 (late/long)</a>
                    </li>
                    <li>
                        <span>Slap:</span><!--            ------  ------  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRLL')">G</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRLL')"><i>G</i></a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRLL')">G</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRR  LL')">G (small gap/on-beat)</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRR        LL')">G (big gap)</a>
                        <span>&nbsp;</span><!--           ------  ------  ------  ------  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRLL')">9</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRLL')"><i>9</i></a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRLL')">9</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRRR  LL')">9 (small gap/on-beat)</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRR        LL')">9 (big gap)</a>
                        <span>Squeeze/Ultimatic:</span>
                        <!--                              ------  ------  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRSS')">G</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRSS')"><i>G</i></a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRSS')">G</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRSSSS')">G (late/long)</a>
                        <span>&nbsp;</span><!--           ------  ------  ------  ------  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRSS')">9</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRSS')"><i>9</i></a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRSS')">9</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRSSSS')">9 (late/long)</a>
                    </li>
                </ul>
            </li>
            <li>
                <b>Middle Switch:</b>
                <ul>
                    <li>
                        <span>Slap:</span><!--            ------  ------  --  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRLLLLLLLLLLL')"><i>Z</i></a>
                        <a href="javascript:simulateKeys('RRRRRRRRRLLLLLLLLLLLLL')">Z (early switch)</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRLLLLLLL')">Z (late/on-beat switch)</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRLLLLLLLLLL')">Z (early release)</a>
                        <a href="javascript:simulateKeys('RRRRRRRRRRRLLLLLLLLLLLL')">Z (late release)</a>
                        <!--                              ------  ------  --  --  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRLLLLLLLLLLLLLLL')"><i>7</i></a>
                        <!--                              ------  ------  ------  --  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRLLLLLLLLLLL')"><i>8</i></a>
                        <span>Squeeze/Ultimatic:</span>
                        <!--                              ------  ------  --  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRSSSSSSSSSSS')"><i>Z</i></a>
                        <!--                              ------  ------  --  --  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRSSSSSSSSSSSSSSS')"><i>7</i></a>
                        <!--                              ------  ------  ------  --  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRRRRRSSSSSSSSSSS')"><i>8</i></a>
                    </li>
                    <li>
                        <span>Slap:</span><!--            --  --  ------  ------  ------  -->
                        <a href="javascript:simulateKeys('LLLLLLRRRRRRRRRRRRRRRRRRRRR')"><i>2</i></a>
                        <a href="javascript:simulateKeys('LLLLLRRRRRRRRRRRRRRRRRRRRRR')">2 (early switch)</a>
                        <a href="javascript:simulateKeys('LLLLLLLRRRRRRRRRRRRRRRRRRRR')">2 (late/on-beat switch)</a>
                        <a href="javascript:simulateKeys('LLLLLLRRRRRRRRRRRRRRRRRRR')">2 (early release)</a>
                        <a href="javascript:simulateKeys('LLLLLLRRRRRRRRRRRRRRRRRRRRRRRRR')">2 (late release)</a>
                        <!--                              --  --  --  ------  ------  -->
                        <a href="javascript:simulateKeys('LLLLLLLLLLRRRRRRRRRRRRR')"><i>3</i></a>
                        <span>Squeeze/Ultimatic:</span>
                        <!--                              --  --  ------  ------  ------  -->
                        <a href="javascript:simulateKeys('LLLLLLSSSSSSSSSSSSSSSSSSSSS')"><i>2</i></a>
                        <!--                              --  --  --  ------  ------  -->
                        <a href="javascript:simulateKeys('LLLLLLLLLLSSSSSSSSSSSSS')"><i>3</i></a>
                    </li>
                </ul>
            </li>
            <li>
                <b>Early Interstitial:</b>
                <ul>
                    <li>
                        <span>Slap:</span><!--            --  ------  --  -->
                        <a href="javascript:simulateKeys('LLLRRRRRRRRLLL')">R</a>
                        <!--                              --  ------  --  --  -->
                        <a href="javascript:simulateKeys('LLLRRRRRRRRLLLLLLL')">L</a>
                        <span>Squeeze:</span>
                        <!--                              --  ------  --  -->
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSS')">R (Iambic-A)</a>
                        <a href="javascript:simulateKeys('LLSSSSS')">R (Iambic-B)</a>
                        <a href="javascript:simulateKeys('LLSSSSSLLLLLLL')">R (All)</a>
                        <!--                              --  ------  --  --  -->
                        <a href="javascript:simulateKeys('LLSSSSSLLLLLLLLLLL')">L (All)</a>
                    </li>
                    <li>
                        <span>Slap:</span><!--            ------  --  ------  -->
                        <a href="javascript:simulateKeys('RRRRRRRLLLLRRRRRRR')">K</a>
                        <!--                              ------  --  ------  ------  -->
                        <a href="javascript:simulateKeys('RRRRRRRLLLLRRRRRRRRRRRRRRR')">Y</a>
                        <span>Squeeze/Iambic/Ultimatic:</span>
                        <!--                              ------  --  ------  -->
                        <a href="javascript:simulateKeys('RRRSSSSSSSSSSSS')">K (Iambic-A)</a>
                        <a href="javascript:simulateKeys('RRRSSSSSSS')">K (Iambic-B)</a>
                        <a href="javascript:simulateKeys('RRSSSSRRRRRRRRR')">K (Ultimatic)</a>
                        <!--                              ------  --  ------  ------  -->
                        <a href="javascript:simulateKeys('RRSSSSRRRRRRRRRRRRRRRRR')">Y (All)</a>
                    </li>
                </ul>
            </li>
            <li>
                <b>Late Interstitial:</b>
                <ul>
                    <li>
                        <span>Slap:</span><!--            --  --  ------  --  -->
                        <a href="javascript:simulateKeys('LLLLLLLRRRRRRRRLLL')">F</a>
                        <!--                              ------  ------  --  ------  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRRRRRLLLLRRRRRRR')">Q</a>
                        <span>Squeeze:</span>
                        <!--                              --  --  ------  --  -->
                        <a href="javascript:simulateKeys('LLLLLLSSSSLLLLLLLL')">F</a>
                        <!--                              ------  ------  --  ------  -->
                        <a href="javascript:simulateKeys('RRRRRRRRRRRSSSSRRRRRRRR')">Q</a>
                    </li>
                </ul>
            </li>
            <li>
                <b>Long Middle Interstitial:</b>
                <ul>
                    <li>
                        <span>Slap/Iambic:</span><!--            --  ------  ------  --  -->
                        <a href="javascript:simulateKeys('LLLRRRRRRRRRRRRRRRRLLL')">P</a>
                        <!--                              ------  --  --  ------  -->
                        <a href="javascript:simulateKeys('RRRRRRRLLLLLLLLRRRRRRR')">X</a>
                        <!--                              --  --  ------  ------  --  --  -->
                        <a href="javascript:simulateKeys('LLLLLLLRRRRRRRRRRRRRRRRLLLLLLL')">?</a>
                        <span>Squeeze/Ultimatic:</span><!--         --  ------  ------  --  -->
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSLLLLLLL')">P</a>
                        <!--                              ------  --  --  ------  -->
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSRRRRR')">X</a>
                        <!--                              --  --  ------  ------  --  --  -->
                        <a href="javascript:simulateKeys('LLLLLLSSSSSSSSSSSSSLLLLLLLLLLL')">?</a>
                    </li>
                </ul>
            </li>
            <li>
                <b>Alternating:</b>
                <ul>
                    <li>
                        <span>Slap:</span><!--            ------  --  ------  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRLLLLRRRRRRRRLLL')">C</a>
                        <!--                              ------  --  --  ------  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRLLLLLLLLRRRRRRRRLLL')">/ (slash)</a>
                        <!--                              --  ------  --  ------  --  ------  -->
                        <a href="javascript:simulateKeys('LLLRRRRRRRRLLLLRRRRRRRRLLLLRRRR')">. (period)</a>
                        <span>Squeeze:</span><!--         ------  --  ------  --  -->
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSSSSSSSSS')">C (Iambic-A)</a>
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSS')">C (Iambic-B)</a>
                        <a href="javascript:simulateKeys('RRSSSSRRRRRRRRSSSS')">C (Ultimatic/All)</a>
                        <!--                              ------  --  --  ------  --  -->
                        <a href="javascript:simulateKeys('RRRRRRRLLLLLLLLRRRRSSSSSSS')">/ (Iambic-A)</a>
                        <a href="javascript:simulateKeys('RRRRRRRLLLLLLLLRRRRSSS')">/ (Iambic-B)</a>
                        <a href="javascript:simulateKeys('RRSSSSSSSSSSSSRRRRRSSSSSSS')">/ (Ultimatic)</a>
                        <!--                              --  ------  --  ------  --  ------  -->
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSSSSSSSSSSSSSS')">. (Iambic-A)</a>
                        <a href="javascript:simulateKeys('LLSSSSSSSSSSSSSSSSSSSSSSSS')">. (Iambic-B)</a>
                        <a href="javascript:simulateKeys('LLSSSSSLLLLLLLSSSSSLLLLLLLSSSSS')">. (Ultimatic)</a>
                    </li>
                </ul>
            </li>
        </ul>
    </body>
</html>